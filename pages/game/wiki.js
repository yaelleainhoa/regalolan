let texts = 
[
	[
		"Mafalda", 
		"Mafalda es el nombre de una tira de prensa argentina creada por el humorista gráfico Quino de 1964 a 1973, protagonizada por la niña homónima, «espejo de la clase media argentina y de la juventud progresista», que se muestra preocupada por la humanidad y la paz mundial y se rebela contra el mundo legado por sus mayores. Mafalda es muy popular en Latinoamérica en general, así como en algunos países europeos: España, Francia, Grecia e Italia. Ha sido traducida a más de treinta idiomas. Umberto Eco, quien ha escrito la introducción a la primera edición italiana de Mafalda, ha dicho amarla «muchísimo» y considera muy importante leer la tira para entender a Argentina."
	],
	[
		"El principito", 
		"El principito (en francés: Le Petit Prince) es una novela corta y la obra más famosa del escritor y aviador francés Antoine de Saint-Exupéry (1900-1944). break		La novela fue publicada en abril de 1943, tanto en francés como en inglés, por la editorial estadounidense Reynal & Hitchcock, mientras que la editorial francesa Gallimard no pudo imprimir la obra hasta 1945, tras la liberación de Francia. Incluido entre los mejores libros del siglo XX en Francia, El principito se ha convertido en el libro escrito en francés más leído y más traducido. Así pues, cuenta con traducciones a más de doscientos cincuenta idiomas, incluyendo el sistema de lectura braille. Además, el libro es considerado el primero del mundo en haber sido transcrito en símbolos fonéticos en lengua inglesa para estudiantes de inglés como segunda lengua. La obra también se ha convertido en uno de los libros más vendidos de todos los tiempos, puesto que ha logrado vender más de 140 millones de ejemplares en todo el mundo, con más de un millón de ventas por año. La novela fue traducida al español por Bonifacio del Carril y su primera publicación en dicho idioma fue realizada por la editorial argentina Emecé Editores en septiembre de 1951. Desde entonces, diversos traductores y editoriales han realizado sus propias versiones. break Saint-Exupéry, ganador de varios de los principales premios literarios de Francia y piloto militar al comienzo de la Segunda Guerra Mundial, escribió e ilustró el manuscrito mientras se encontraba exiliado en los Estados Unidos tras la batalla de Francia. Ahí tenía la misión personal de persuadir al gobierno de dicho país para que le declarara la guerra a la Alemania nazi. En medio de una crisis personal y con la salud cada vez más deteriorada, produjo en su exilio casi la mitad de los escritos por los que sería recordado; entre ellos, El principito, un relato considerado un libro infantil por la forma en la que está escrito, pero que es en realidad una crítica a la adultez en la que se tratan temas profundos como el sentido de la vida, la soledad, la amistad, el amor y la pérdida. break En relatos autobiográficos previos, se relatan sus experiencias como aviador en el desierto del Sahara y se cree que esas mismas experiencias le sirvieron como elementos para el argumento de El principito. Desde su primera publicación, la novela ha dado lugar a diversas adaptaciones a lo largo del tiempo, entre las que se incluyen grabaciones de audio, obras de teatro, películas, ballets, obras de ópera e incluso una serie animada y un anime."
	],
	[
		"Inza", 
		"Inza (en euskera: Intza) es una localidad y un concejo del municipio de Araiz, en la Comunidad Foral de Navarra (España). Situado en la Merindad de Pamplona, en la comarca de Norte de Aralar y a 45 km de la capital de la comunidad, Pamplona. Su población en 2014 fue de 66 habitantes (INE). El concejo tiene una superficie de 8,97 km² y una densidad de población de 8,03 hab/km². "
	],
	[
		"Calimocho", 
		"El calimocho (del euskera kalimotxo) es un cóctel de vino tinto y refresco carbonatado de cola. La mezcla goza de gran popularidad en distintas regiones de España e Hispanoamérica. break La mezcla recibe diversos nombres: en España también kalimotxo en el País Vasco; mocho, Rioja libre o ribermocho en la Ribera del Duero, así como bicicleta, la chapa o donisau en tierras del centro de la península; en Argentina rocanrol, cascarudo, dos tonos, cachetiao, vinola, karimocho, rifle según un campero cordobés, o simplemente como vino con coca; en Brasil es conocido como vinhoca; en Chile, como jote (en referencia al ave jote), licor de ave, vino cola o tincola (vino tinto con bebida cola) y en Uruguay como vino cortado (por analogía con el café).  break Generalmente se emplea vino barato, aunque cuanto mejor sea el vino, mejor será la mezcla resultante. En cuanto a las proporciones y si se bebe frío, incluyendo hielo, o a temperatura ambiente, va a depender del lugar geográfico donde se esté consumiendo, como también del gusto personal. Un combinado normal consiste en servir el calimocho en un vaso ancho con hielos mezclando a partes iguales el vino y la cola. "
	],
	[
		"Topología", 
		"La topología (del griego τόπος, 'lugar', y λόγος, 'estudio') es la rama de la matemática dedicada al estudio de aquellas propiedades de los cuerpos geométricos que permanecen inalteradas por transformaciones continuas. Es una disciplina que estudia las propiedades de los espacios topológicos y las funciones continuas. La topología se interesa por conceptos como proximidad, número de agujeros, el tipo de consistencia (o textura) que presenta un objeto, comparar objetos y clasificar múltiples atributos donde destacan conectividad, compacidad, metricidad o metrizabilidad, entre otros. break Los matemáticos usan la palabra topología con dos sentidos: informalmente es el sentido arriba especificado, y de manera formal es la referencia a una cierta familia de subconjuntos de un conjunto dado, familia que cumple unas reglas sobre la unión y la intersección —este segundo sentido puede verse desarrollado en el artículo espacio topológico—. "
	],
	[
		"José Ángel Iribar", 
		"José Ángel Iribar Kortajarena (Zarauz, Guipúzcoa, 1 de marzo de 1943) es un exfutbolista y exentrenador. Fue portero del Athletic Club entre 1962 y 1979, con el que ganó dos campeonatos de Copa (1969 y 1973) y un Trofeo Zamora. Además, entre 1964 y 1976 fue el guardameta titular de la selección española, con la que ganó la Eurocopa de 1964. break Con 614 encuentros, es el jugador con más partidos en la historia del club rojiblanco. Además, logró tres subcampeonatos de Copa, un subcampeonato de Liga en 1970 y un subcampeonato de la Copa de la UEFA en 1977. break Se retiró al finalizar la temporada 1979-80, si bien, fue el 12 de diciembre de 1979 cuando jugó su último partido. Después ejerció como entrenador en las categorías inferiores del Athletic, también fue entrenador del primer equipo en la temporada 1986-87 y, posteriormente, trabajó como entrenador de porteros hasta que fue sustituido por Walter Junghans en 2001. Actualmente es el presidente de la asociación de veteranos del Athletic Club y uno de los representantes institucionales del club, siendo un habitual en los viajes con la primera plantilla."
	]
];

var wordsToGuess = [];
var currentPageIndex = 0;

function setGames()
{
	for(let i = 0; i<texts.length; i++)
	{
		var page = document.createElement("div");
		

		var title = document.createElement("h1");
		title.id = "title"+String(i);
		title.classList.add("invisible");
		var currentTitleToGuess = splitSentence(texts[i][0]);
		
		var text = document.createElement("div");
		text.id = "page"+String(i);
		text.classList.add("invisible")
		var currentWordsToGuess = splitSentence(texts[i][1]);

		page.appendChild(title);
		page.appendChild(text);
		document.getElementById("pages").appendChild(page);

		wordsToGuess.push([currentTitleToGuess, currentWordsToGuess]);

		var currentSelect = document.createElement("option")
		currentSelect.value = i;
		currentSelect.text = "Manche "+String(i+1);
		document.getElementById("select").appendChild(currentSelect)

		createHiddenItems(currentTitleToGuess,i, "title");
		createHiddenItems(currentWordsToGuess,i, "page");
	}
	document.getElementById("page"+String(currentPageIndex)).classList.remove("invisible");
	document.getElementById("title"+String(currentPageIndex)).classList.remove("invisible");
}

function changePage(index)
{
	currentPageIndex = index;
	for(let i = 0; i<texts.length; i++)
	{
		document.getElementById("page"+String(i)).classList.add("invisible");
		document.getElementById("title"+String(i)).classList.add("invisible");
	}
	document.getElementById("page"+String(currentPageIndex)).classList.remove("invisible");
	document.getElementById("title"+String(currentPageIndex)).classList.remove("invisible");
}

function splitSentence(sentence) {
    var pattern = /([\wÀ-ÖØ-öø-ÿ]+|[ ,])/gu;
    var result = sentence.split(pattern).filter(function (element) {
        return element !== ''; 
    });
    return result;
}

function findWordIndices(array, word) {
	var indices = [];
	for (var i = 0; i < array.length; i++) {
	  if (array[i].toLowerCase() === word) {
		indices.push(i);
	  }
	}
	return indices;
  }

function isWord(elt)
{
	var wordPattern = /[\wÀ-ÖØ-öø-ÿ]+/;
	return wordPattern.test(elt);
}

function createHiddenItems(separateWords, pageNb, eltType)
{
	for(var i = 0; i < separateWords.length ; i++)
	{
		if(separateWords[i] == "break")
		{
			document.getElementById(eltType+String(pageNb)).appendChild(document.createElement("br"));
			document.getElementById(eltType+String(pageNb)).appendChild(document.createElement("br"));
		}
		else{
			var span = document.createElement("span");
			var word = document.createTextNode(separateWords[i]);
			span.appendChild(word);
			document.getElementById(eltType+String(pageNb)).appendChild(span);
			if(isWord(separateWords[i]))
			{
				span.classList.add("inconnu");
			}
			else
			{
				span.classList.add("connu");
			}
			span.classList.add("index"+String(i));
		}

	}
}

window.addEventListener("keydown", function(e) {
	var touche = e.keyCode;
	var mot = document.getElementById("prop").value;
	if (touche === 13) {
		verifier(mot, wordsToGuess[currentPageIndex][0], 0); 
		verifier(mot, wordsToGuess[currentPageIndex][1], 1); 
		document.getElementById("prop").value ="";
	}
}, true);

document.getElementById("select").addEventListener("change", function(e)
{
	var selectedValue = document.getElementById("select").value;
	changePage(selectedValue)
});

function verifier(input, text, indexType) 
{
	var eltType = indexType == 0 ? "#title" : "#page"

	justGuessedElts = document.querySelectorAll(eltType+String(currentPageIndex)+' .justGuessed');

	Array.from(justGuessedElts).forEach(function(elt)
	{
		elt.classList.remove("justGuessed")
	})

	var wordToTest = input.toLowerCase();
	var wordsGuessed = findWordIndices(text, wordToTest);

	for(let i = 0; i < wordsGuessed.length; i++)
	{
		document.querySelectorAll(eltType+String(currentPageIndex)+' .inconnu.index'+String(wordsGuessed[i]))[0].classList.replace("inconnu", "justGuessed")
	}
}


function devoiler_reponse() 
{
	var spanElements = document.querySelectorAll('#page'+String(currentPageIndex)+' .inconnu');

	Array.from(spanElements).forEach(function(elt)
	{
		elt.classList.remove("inconnu")
	})

	spanElements = document.querySelectorAll('#title'+String(currentPageIndex)+' .inconnu');

	Array.from(spanElements).forEach(function(elt)
	{
		elt.classList.remove("inconnu")
	})

	justGuessedElts = document.querySelectorAll('.justGuessed');

	Array.from(justGuessedElts).forEach(function(elt)
	{
		elt.classList.remove("justGuessed")
	})
	
}

setGames();